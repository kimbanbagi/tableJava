<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dc.human.kimbanbagi.tableJava.book.dao.BookDAO">
    <resultMap id="book" type="dc.human.kimbanbagi.tableJava.book.vo.BookVO">
        <result property="uId" column="user_id" />
        <result property="rId" column="restaurant_id" />
        <result property="rName" column="restaurant_name" />
        <result property="rDate" column="reservation_date" />
        <result property="rTime" column="reservation_time" />
        <result property="rStatus" column="reservation_status" />
        <result property="aCount" column="adult_count" />
        <result property="kCount" column="kids_count" />
        <result property="sCount" column="stroller" />
        <result property="wCount" column="wheelchair" />
        <result property="requirements" column="requirements" />
        <result property="uName" column="user_name" />
        <result property="written" column="written_status" />
    </resultMap>

    <select id="getUserBookList" resultMap="book">
        <![CDATA[
            SELECT
                restaurant_id,
                restaurant_name,
                reservation_date,
                reservation_time,
                DECODE(reservation_status, '0', '예약 대기', '1', '예약 확정', '2', '예약 취소', '3', '예약 거절', '4', '예약 종료') reservation_status,
                adult_count,
                kids_count,
                stroller,
                wheelchair,
                requirements,
                user_name,
                written_status
            FROM reservation
            WHERE user_id=#{userId}
        ]]>
    </select>

    <select id="getOwnerBookList" resultMap="book">
        <![CDATA[
        SELECT
            user_id,
            restaurant_name,
            reservation_date,
            reservation_time,
            DECODE(reservation_status, '0', '예약 대기', '1', '예약 확정', '2', '예약 취소', '3', '예약 거절', '4', '예약 종료') reservation_status,
            adult_count,
            kids_count,
            stroller,
            wheelchair,
            requirements,
            user_name,
            written_status
        FROM reservation
        WHERE restaurant_id=#{restaurantId}
        ]]>
    </select>

    <insert id="addBook" parameterType="dc.human.kimbanbagi.tableJava.book.vo.BookVO">
        <![CDATA[
            INSERT INTO reservation (
                                     user_id,
                                     restaurant_id,
                                     restaurant_name,
                                     reservation_date,
                                     reservation_time,
                                     reservation_status,
                                     adult_count,
                                     kids_count,
                                     stroller,
                                     wheelchair,
                                     requirements,
                                     user_name,
                                     created_id,
                                     created_date,
                                     written_status
            ) values (
                      #{uId},
                      #{rId},
                      #{rName},
                      #{rDate},
                      #{rTime},
                      #{rStatus},
                      #{aCount},
                      #{kCount},
                      #{sCount},
                      #{wCount},
                      #{requirements},
                      #{uName},
                      #{uId},
                      #{createdDate},
                      #{written}
                     )
        ]]>
    </insert>

    <update id="cancelBookFromUser" parameterType="String">
        <![CDATA[
        UPDATE reservation SET
                                    reservation_status='2'
        WHERE user_id=#{userId} AND restaurant_id=#{restaurantId}
        ]]>
    </update>

    <update id="confirmBook" parameterType="String">
        <![CDATA[
            UPDATE reservation SET
                                   reservation_status='1'
            WHERE user_id=#{bookId} AND restaurant_id=#{restaurantId}
        ]]>
    </update>

    <update id="cancelBookFromOwner" parameterType="String">
        <![CDATA[
        UPDATE reservation SET
            reservation_status='3'
        WHERE user_id=#{bookId} AND restaurant_id=#{restaurantId}
        ]]>
    </update>

    <update id="endBook" parameterType="String">
        <![CDATA[
        UPDATE reservation SET
            reservation_status='4'
        WHERE user_id=#{bookId} AND restaurant_id=#{restaurantId}
        ]]>
    </update>

    <select id="getHistory" resultMap="book">
        <![CDATA[
        SELECT
            user_id,
            user_name,
            restaurant_name,
            restaurant_id,
            reservation_date,
            reservation_time,
            written_status
        FROM reservation
        WHERE user_id=#{userId} AND reservation_status='4'
        ]]>
    </select>

    <update id="updateWritten" parameterType="String">
        <![CDATA[
            UPDATE reservation SET
                                   written_status='T'
            WHERE user_id=#{userId} AND restaurant_id=#{restaurantId}
        ]]>
    </update>

</mapper>